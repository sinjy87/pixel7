<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="i_order"> 

	<select id="num" parameterType="Map" resultType="I_OrderDTO">
	select i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, to_char(odate, 'yyyy-mm-dd') odate, r
	from(
		select i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, odate, rownum r
		from(
			select i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, odate
			from i_order
			order by odate DESC
			)
		)
	<![CDATA[where r >= 1 and r <= 1]]>
	</select>

	<select id="id" parameterType="int" resultType="String">
		select id from img_item
		where img_num=#{img_num} 
	</select>

	<!-- img_num에 대한 내용 -->
	<select id="content" parameterType="int" resultType="String">
		select img_content from img_item
		where img_num=#{img_num} 
	</select>
	
	<!-- img_num에 대한 사진 -->
	<select id="photo" parameterType="int" resultType="String">
		select img_photo from img_item
		where img_num=#{img_num} 
	</select>

	<!-- img_num에 대한 가격 -->
	<select id="price" parameterType="int" resultType="String">
		select img_price from img_item
		where img_num=#{img_num} 
	</select>

	<delete id="delete" parameterType="int">
		delete from i_order
		where i_order_num = #{i_order_num}
	</delete>
	
	<update id="update" parameterType="I_OrderDTO">
		update i_order set i_order_information=#{i_order_information}
		where i_order_num=#{i_order_num}
	</update>

	<insert id="create" parameterType="I_OrderDTO">
		insert into i_order(i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, odate)
		values((select nvl(max(i_order_num),0)+1 as i_order_num from i_order),
		#{img_num}, #{id}, #{orderid}, #{i_order_total}, #{i_order_mileage}, #{i_order_information}, sysdate)
	</insert>

	<select id="read" parameterType="int" resultType="I_OrderDTO">
		select i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, to_char(odate, 'yyyy-mm-dd') odate from i_order
		where i_order_num=#{i_order_num}
	</select>

	<select id="total" parameterType="Map" resultType="int">
		select count(*) from i_order
	</select>

	<select id="list" parameterType="Map" resultType="I_OrderDTO">
		select i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, to_char(odate, 'yyyy-mm-dd') odate, r
		from(
			select i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, odate, rownum r
			from(
				select i_order_num, img_num, id, orderid, i_order_total, i_order_mileage, i_order_information, odate
				from i_order
				order by i_order_num DESC
				)
			)
			where id = #{id}
	</select>
</mapper>